<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PMS Gateway - Ä°stemci Paneli</title>
  <style>
    :root { --bg: #0f1419; --card: #1a2332; --border: #2d3a4d; --text: #e6edf3; --muted: #8b949e; --accent: #58a6ff; --ok: #3fb950; --err: #f85149; }
    * { box-sizing: border-box; }
    body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 1rem; }
    h1 { font-size: 1.5rem; margin-bottom: 1.5rem; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 1.25rem; margin-bottom: 1rem; }
    .card h2 { font-size: 1rem; margin: 0 0 0.75rem 0; color: var(--muted); }
    label { display: block; margin-bottom: 0.25rem; font-size: 0.875rem; color: var(--muted); }
    input, select, button { padding: 0.5rem 0.75rem; border-radius: 6px; border: 1px solid var(--border); background: var(--bg); color: var(--text); font-size: 0.875rem; }
    input { width: 100%; max-width: 320px; }
    select { min-width: 160px; }
    button { cursor: pointer; background: var(--accent); color: #fff; border: none; margin-right: 0.5rem; margin-top: 0.5rem; }
    button.secondary { background: var(--border); }
    .row { display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-end; margin-bottom: 0.75rem; }
    .tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
    .tabs a { padding: 0.5rem 1rem; background: var(--card); border: 1px solid var(--border); border-radius: 6px; color: var(--text); text-decoration: none; }
    .tabs a.active { background: var(--accent); border-color: var(--accent); color: #fff; }
    .tab { display: none; }
    .tab.active { display: block; }
    .badge { display: inline-block; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem; }
    .badge.ok { background: var(--ok); color: #000; }
    .badge.err { background: var(--err); color: #fff; }
    .badge.warn { background: #d29922; color: #000; }
    table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
    th, td { text-align: left; padding: 0.5rem; border-bottom: 1px solid var(--border); }
    .dashboard-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 0.75rem; margin-bottom: 1rem; }
    .dashboard-cards .card { margin: 0; padding: 0.75rem; }
    .dashboard-cards .card .val { font-size: 1.25rem; font-weight: 600; }
    #testResult { margin-top: 0.75rem; white-space: pre-wrap; font-size: 0.8rem; }
    .test-banner { background: #1f2937; border: 1px solid #d29922; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
    .test-banner strong { color: #d29922; }
    .help-text { font-size: 0.8rem; color: var(--muted); margin-top: 0.5rem; line-height: 1.4; }
    .notes-box { background: #161b22; border-left: 4px solid var(--accent); padding: 0.75rem 1rem; margin: 0.75rem 0; font-size: 0.85rem; }
    .notes-box summary { cursor: pointer; font-weight: 600; color: var(--accent); }
    .notes-box ul { margin: 0.5rem 0 0 1rem; padding: 0; }
  </style>
</head>
<body>
  <div class="test-banner">
    <strong>ğŸ§ª TEST ORTAMI</strong> â€” Bu panel test ve kurulum iÃ§in kullanÄ±lÄ±r. CanlÄ± sistemde aynÄ± ayarlar API veya yÃ¶netim paneli Ã¼zerinden yapÄ±lmalÄ±dÄ±r.
  </div>

  <h1>PMS Gateway â€“ Ä°stemci Paneli</h1>

  <details class="notes-box">
    <summary>Ã–nemli notlar & Ne yapacaÄŸÄ±m?</summary>
    <ul>
      <li><strong>Ne yapacaÄŸÄ±m?</strong> Ã–nce "KiracÄ± & Provider" bÃ¶lÃ¼mÃ¼nde Tenant ID ve PMS tÃ¼rÃ¼nÃ¼ (MySQL/MSSQL/PostgreSQL/API) seÃ§. Sonra ilgili veritabanÄ± veya API bilgilerini doldur. "AyarlarÄ± kaydet" ile gÃ¶nder. "BaÄŸlantÄ±yÄ± test et" ile PMSâ€™e eriÅŸimi doÄŸrula. "Test verify" ile oda + identity ile doÄŸrulama simÃ¼le et.</li>
      <li><strong>KayÄ±t nereye gidiyor?</strong> Ayarlar ÅŸu an sunucunun belleÄŸinde tutuluyor. PM2 veya uygulama yeniden baÅŸlayÄ±nca silinir. KalÄ±cÄ± kayÄ±t iÃ§in ileride veritabanÄ± eklenebilir.</li>
      <li><strong>Fail Mode:</strong> PMSâ€™e ulaÅŸÄ±lamadÄ±ÄŸÄ±nda (aÄŸ hatasÄ±, circuit aÃ§Ä±k) ne olsun? <em>deny</em> = giriÅŸ reddedilir, <em>bypass</em> = giriÅŸe izin verilir.</li>
      <li><strong>Unknown Mode:</strong> PMS â€œunknownâ€ status dÃ¶ndÃ¼rÃ¼rse: <em>deny</em> = red, <em>short_session</em> = kabul + kÄ±sa oturum sÃ¼resi.</li>
      <li><strong>Adres:</strong> Panel ve APIâ€™ye <code>http://</code> ile baÄŸlan (SSL kapalÄ± test ortamÄ±nda). <code>https://</code> kullanma.</li>
    </ul>
  </details>

  <div class="tabs">
    <a href="#" class="tab-link active" data-tab="settings">PMS AyarlarÄ±</a>
    <a href="#" class="tab-link" data-tab="dashboard">PMS Dashboard</a>
  </div>

  <div id="settings" class="tab active">
    <div class="card">
      <h2>KiracÄ± & Provider</h2>
      <p class="help-text">Her otel/ÅŸube iÃ§in bir Tenant ID kullanÄ±n. Provider: PMSâ€™in tÃ¼rÃ¼ (Yok / API / MySQL / MSSQL / PostgreSQL). Fail Mode ve Unknown Mode ile hata durumunda davranÄ±ÅŸÄ± belirleyin.</p>
      <div class="row">
        <div>
          <label>Tenant ID</label>
          <input type="text" id="tenantId" placeholder="tenant-1" value="tenant-1" />
        </div>
        <div>
          <label>PMS Provider</label>
          <select id="pms_provider">
            <option value="none">Yok</option>
            <option value="api">API (REST)</option>
            <option value="mysql">MySQL</option>
            <option value="mssql">MSSQL</option>
            <option value="postgres">PostgreSQL</option>
          </select>
        </div>
        <div>
          <label>Fail Mode</label>
          <select id="pms_fail_mode">
            <option value="deny">deny</option>
            <option value="bypass">bypass</option>
          </select>
        </div>
        <div>
          <label>Unknown Mode</label>
          <select id="pms_unknown_mode">
            <option value="deny">deny</option>
            <option value="short_session">short_session</option>
          </select>
        </div>
        <div>
          <label>Session timeout (dk)</label>
          <input type="number" id="pms_session_timeout_minutes" value="60" min="1" max="1440" />
        </div>
      </div>
    </div>

    <div class="card" id="sqlMapping">
      <h2>SQL eÅŸleme (MySQL / MSSQL / PostgreSQL)</h2>
      <p class="help-text">Provider MySQL, MSSQL veya PostgreSQL ise bu alanlarÄ± doldurun. Tablo ve sÃ¼tun adlarÄ± PMS veritabanÄ±nÄ±zdaki gerÃ§ek isimlerle eÅŸleÅŸmeli (Ã¶rn. room_number, checkout_at). docs/OTEL_PMS_ENTEGRASYON.md iÃ§inde Ã¶rnek configâ€™ler var.</p>
      <div class="row">
        <div><label>DB Host</label><input type="text" id="pms_db_host" placeholder="localhost" /></div>
        <div><label>Port</label><input type="number" id="pms_db_port" placeholder="3306" /></div>
        <div><label>User</label><input type="text" id="pms_db_user" /></div>
        <div><label>Password</label><input type="password" id="pms_db_password" /></div>
        <div><label>Database</label><input type="text" id="pms_db_database" /></div>
      </div>
      <div class="row">
        <div><label>Tablo</label><input type="text" id="pms_sql_table" placeholder="reservations" /></div>
        <div><label>Oda sÃ¼tunu</label><input type="text" id="pms_sql_room_column" placeholder="room_number" /></div>
        <div><label>Ä°sim sÃ¼tunu</label><input type="text" id="pms_sql_name_column" /></div>
        <div><label>TC sÃ¼tunu</label><input type="text" id="pms_sql_tc_column" /></div>
        <div><label>Pasaport sÃ¼tunu</label><input type="text" id="pms_sql_passport_column" /></div>
      </div>
      <div class="row">
        <div><label>Check-in sÃ¼tunu</label><input type="text" id="pms_sql_checkin_column" /></div>
        <div><label>Check-out sÃ¼tunu</label><input type="text" id="pms_sql_checkout_column" /></div>
        <div><label>Status sÃ¼tunu</label><input type="text" id="pms_sql_status_column" /></div>
        <div><label>In-house deÄŸeri</label><input type="text" id="pms_sql_inhouse_value" placeholder="in_house" /></div>
        <div><label>External ref sÃ¼tunu</label><input type="text" id="pms_sql_external_ref_column" /></div>
      </div>
    </div>

    <div class="card" id="apiMapping">
      <h2>API (REST)</h2>
      <p class="help-text">Provider â€œAPI (REST)â€ ise PMSâ€™in verify endpointâ€™inin tam URLâ€™sini ve gerekirse API Keyâ€™i girin.</p>
      <div class="row">
        <div><label>API URL</label><input type="url" id="pms_api_url" placeholder="https://pms.example.com/api" /></div>
        <div><label>API Key</label><input type="text" id="pms_api_key" placeholder="opsiyonel" /></div>
      </div>
    </div>

    <div class="card">
      <h2>Kaydet & Test</h2>
      <p class="help-text">Ã–nce â€œAyarlarÄ± kaydetâ€ ile formu sunucuya gÃ¶nderin. â€œBaÄŸlantÄ±yÄ± test etâ€ ile seÃ§ili providerâ€™a (DB veya API) gerÃ§ekten ulaÅŸÄ±lÄ±p ulaÅŸÄ±lamadÄ±ÄŸÄ±nÄ± kontrol edin; sonuÃ§ aÅŸaÄŸÄ±da gÃ¶rÃ¼nÃ¼r.</p>
      <button id="btnSave">AyarlarÄ± kaydet</button>
      <button id="btnTest" class="secondary">BaÄŸlantÄ±yÄ± test et</button>
      <pre id="testResult"></pre>
    </div>

    <div class="card">
      <h2>DoÄŸrulama testi</h2>
      <p class="help-text">Oda numarasÄ± ve identity hash ile misafir doÄŸrulamasÄ±nÄ± simÃ¼le eder. Ayarlar kayÄ±tlÄ± ve provider eriÅŸilebilir olmalÄ±. SonuÃ§ aÅŸaÄŸÄ±da (matched, status, ok, latency vb.) gÃ¶rÃ¼nÃ¼r.</p>
      <div class="row">
        <div><label>Oda no</label><input type="text" id="testRoom" placeholder="101" /></div>
        <div><label>Identity hash</label><input type="text" id="testIdentityHash" placeholder="hash123" /></div>
      </div>
      <button id="btnVerify">Test verify</button>
      <pre id="verifyResult"></pre>
    </div>
  </div>

  <div id="dashboard" class="tab">
    <div class="card">
      <h2>Ãœst kartlar</h2>
      <p class="help-text">Provider durumu, circuit breaker, cache hit oranÄ± ve son 24 saatteki doÄŸrulama sayÄ±sÄ±. Tenant ID yukarÄ±da seÃ§ili olanla aynÄ±.</p>
      <div class="dashboard-cards" id="dashboardCards"></div>
    </div>
    <div class="card">
      <h2>Son 50 doÄŸrulama</h2>
      <p class="help-text">Bu tenant iÃ§in son 50 doÄŸrulama kaydÄ± (oda, status, provider, cache, gecikme). Test verify veya login Ã§aÄŸrÄ±larÄ± burada listelenir.</p>
      <table>
        <thead><tr><th>Oda</th><th>Status</th><th>Provider</th><th>Cache</th><th>Latency</th><th>Tarih</th></tr></thead>
        <tbody id="verificationTable"></tbody>
      </table>
    </div>
    <div class="card">
      <h2>Checkout job</h2>
      <p class="help-text">10 dakikada bir Ã§alÄ±ÅŸan job: checkout olan kullanÄ±cÄ±larÄ± tespit eder, RADIUS/MikroTik ile oturumu kapatÄ±r. Son Ã§alÄ±ÅŸma zamanÄ± ve kapatÄ±lan sayÄ± burada gÃ¶rÃ¼nÃ¼r.</p>
      <p id="jobStatus"></p>
    </div>
  </div>

  <script src="/panel/panel.js"></script>
</body>
</html>
